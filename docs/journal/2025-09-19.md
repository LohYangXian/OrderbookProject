# Order Book Engine Design Journal

## 2025-09-19: Initial Data Exploration

### Starting with Binance WebSocket

Before designing the order book data structures, I am focusing on understanding the real-world message formats by connecting to Binance's WebSocket API (`btcusdt@depth`). This approach enables:

- Direct observation of the JSON structure for live order book updates.
- Capturing realistic snapshots for use in unit and integration tests.
- Ensuring the engine's API and data models align with actual exchange semantics.

### Steps Taken

1. **Set up a minimal WebSocket client**  
   - Connects to Binance's depth stream.
   - Prints raw JSON messages to stdout for inspection.

2. **Capture Sample Data**  
   - Save several raw messages as JSON files.
   - Use these samples to seed tests and validate parsing logic.

3. **Document Message Structure**  
   - Paste a sample message below for reference.
   - Annotate key fields (bids, asks, event time, etc.).

### Goal

Maintain a **local order book** that accurately reflects the state of the Binance market in real time.

### Stream Options

- **Raw Stream:**  
  - URL: `wss://fstream.binance.com/ws/<symbol>@depth`
  - Delivers updates for a single symbol.
  - Message payload is the direct `depthUpdate` object.

- **Combined Stream:**  
  - URL: `wss://fstream.binance.com/stream?streams=<symbol1>@depth/<symbol2>@depth`
  - Delivers updates for multiple symbols in one connection.
  - Each message is wrapped as:  
    `{ "stream": "<symbol>@depth", "data": { ...depthUpdate... } }`

### Decision

For this project, I am **starting with the raw stream** (`wss://fstream.binance.com/ws/btcusdt@depth`) because:
- Only one symbol needs to be tracked initially.
- The message format is simpler (no wrapper).
- Easier to prototype and debug.

If multi-symbol support is needed, switching to the combined stream is straightforward.

### Why Use Depth Streams?

- Depth streams provide real-time updates for bids and asks.
- By combining these updates with an initial REST snapshot, the local order book can be kept accurate.
- This method is recommended by Binance for latency-sensitive trading systems.

### 

### Next Steps

- Implement the WebSocket client to connect to the raw depth stream.
- Fetch the initial order book snapshot via REST API.
- Merge incoming updates into the local order book.

---